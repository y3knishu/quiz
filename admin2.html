<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
</head>
<body>
  <h2>Admin Login</h2>
  <div id="login-section">
    <input type="email" id="loginEmail" placeholder="Email">
    <input type="password" id="loginPassword" placeholder="Password">
    <button onclick="emailLogin()">Login with Email</button>
    <br><br>
    <button onclick="googleLogin()">Login with Google</button>
    <button onclick="appleLogin()">Login with Apple</button>
  </div>

  <div id="admin-section" style="display:none;">
    <h2>Admin Dashboard</h2>

    <h3>Add New User</h3>
    <input type="text" id="newUserId" placeholder="User ID">
    <input type="email" id="newUserEmail" placeholder="Email">
    <input type="text" id="newUserPhone" placeholder="Phone">
    <select id="newUserPaid">
      <option value="">Select Payment Status</option>
      <option value="Paid">Paid</option>
      <option value="Unpaid">Unpaid</option>
    </select>
    <button onclick="addUser()">Add User</button>

    <h3>All Users</h3>
    <table border="1" id="usersTable">
      <thead>
        <tr>
          <th>User ID</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Payment Status</th>
          <th>Change Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAMNDoNuqkWfXEGYdwueJb5XTr1ST2ztKc",
    authDomain: "mcqs-96117.firebaseapp.com",
    projectId: "mcqs-96117",
    storageBucket: "mcqs-96117.firebasestorage.app",
    messagingSenderId: "352256319143",
    appId: "1:352256319143:web:74b2bd062a7f2dc5f1c582",
    measurementId: "G-6FZ770H045"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  function emailLogin() {
    const email = document.getElementById("loginEmail").value;
    const pass = document.getElementById("loginPassword").value;
    auth.signInWithEmailAndPassword(email, pass).catch(alert);
  }

  function googleLogin() {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithRedirect(provider);
  }

  function appleLogin() {
    const provider = new firebase.auth.OAuthProvider('apple.com');
    auth.signInWithRedirect(provider);
  }

  auth.onAuthStateChanged(user => {
    if (user && user.email === "y3knishu@gmail.com") {
      document.getElementById("login-section").style.display = "none";
      document.getElementById("admin-section").style.display = "block";
      loadUsers();
    } else if (user) {
      alert("Access denied. Not admin.");
      auth.signOut();
    }
  });

  function addUser() {
    const userId = document.getElementById("newUserId").value.trim();
    const email = document.getElementById("newUserEmail").value.trim();
    const phone = document.getElementById("newUserPhone").value.trim();
    const paidStatus = document.getElementById("newUserPaid").value;

    if (!userId) {
      alert("User ID is required");
      return;
    }

    let dataToSave = {};
    if (email) dataToSave.email = email;
    if (phone) dataToSave.phone = phone;
    if (paidStatus) dataToSave.paidStatus = paidStatus;

    db.collection("users").doc(userId).set(dataToSave, { merge: true })
      .then(() => {
        alert("User added/updated successfully");
        loadUsers();
      })
      .catch(alert);
  }

  function loadUsers() {
    const tbody = document.querySelector("#usersTable tbody");
    tbody.innerHTML = "";
    db.collection("users").get().then(snapshot => {
      snapshot.forEach(doc => {
        const user = doc.data();
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${doc.id}</td>
          <td>${user.email || ""}</td>
          <td>${user.phone || ""}</td>
          <td>${user.paidStatus || ""}</td>
          <td>
            <select onchange="updatePaymentStatus('${doc.id}', this.value)">
              <option value="Paid" ${user.paidStatus === "Paid" ? "selected" : ""}>Paid</option>
              <option value="Unpaid" ${user.paidStatus === "Unpaid" ? "selected" : ""}>Unpaid</option>
            </select>
          </td>
        `;
        tbody.appendChild(tr);
      });
    });
  }

  function updatePaymentStatus(userId, status) {
    db.collection("users").doc(userId).set({ paidStatus: status }, { merge: true });
  }
</script>
</body>
</html>
