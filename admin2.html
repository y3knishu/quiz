<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f5f5f5;
        color: #333;
    }
    h2 {
        text-align: center;
    }
    table {
        border-collapse: collapse;
        width: 100%;
        margin-top: 20px;
        background: white;
    }
    table, th, td {
        border: 1px solid #ccc;
    }
    th, td {
        padding: 10px;
        text-align: left;
    }
    .hidden {
        display: none;
    }
    .form-container {
        background: white;
        padding: 15px;
        margin-top: 20px;
        border: 1px solid #ccc;
    }
    button {
        padding: 8px 12px;
        margin: 5px;
        background: #1976d2;
        color: white;
        border: none;
        cursor: pointer;
    }
    button:hover {
        background: #0d47a1;
    }
    select {
        padding: 5px;
    }
</style>
</head>
<body>

<h2>Admin Dashboard</h2>

<div id="loginDiv">
    <h3>Login</h3>
    <input type="email" id="email" placeholder="Email"><br><br>
    <input type="password" id="password" placeholder="Password"><br><br>
    <button onclick="emailLogin()">Login with Email</button>
    <button onclick="googleLogin()">Login with Google</button>
    <button onclick="appleLogin()">Login with Apple</button>
</div>

<div id="adminDiv" class="hidden">
    <p><b>Total Users:</b> <span id="totalUsers">0</span> |
       <b>Paid Users:</b> <span id="paidUsers">0</span></p>
    <button onclick="showAddUserForm()">Add User</button>
    <div id="addUserForm" class="form-container hidden">
        <h3>Add New User</h3>
        <input type="text" id="newName" placeholder="Name"><br><br>
        <input type="email" id="newEmail" placeholder="Email"><br><br>
        <input type="text" id="newPhone" placeholder="Phone"><br><br>
        <select id="newPaymentStatus">
            <option value="Unpaid">Unpaid</option>
            <option value="Paid">Paid</option>
        </select><br><br>
        <button onclick="addUser()">Save</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>User ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Payment Status</th>
                <th>Date Added</th>
            </tr>
        </thead>
        <tbody id="usersTable"></tbody>
    </table>
</div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyAMNDoNuqkWfXEGYdwueJb5XTr1ST2ztKc",
    authDomain: "mcqs-96117.firebaseapp.com",
    projectId: "mcqs-96117",
    storageBucket: "mcqs-96117.firebasestorage.app",
    messagingSenderId: "352256319143",
    appId: "1:352256319143:web:74b2bd062a7f2dc5f1c582",
    measurementId: "G-6FZ770H045"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

function emailLogin() {
    const email = document.getElementById("email").value;
    const pass = document.getElementById("password").value;
    auth.signInWithEmailAndPassword(email, pass).catch(alert);
}

function googleLogin() {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithRedirect(provider);
}

function appleLogin() {
    const provider = new firebase.auth.OAuthProvider('apple.com');
    auth.signInWithRedirect(provider);
}

auth.onAuthStateChanged(user => {
    if (user) {
        if (user.email === "y3knishu@gmail.com") {
            document.getElementById("loginDiv").classList.add("hidden");
            document.getElementById("adminDiv").classList.remove("hidden");
            loadUsers();
        } else {
            alert("Access Denied");
            auth.signOut();
        }
    }
});

function loadUsers() {
    db.collection("users").onSnapshot(snapshot => {
        const table = document.getElementById("usersTable");
        table.innerHTML = "";
        let total = 0;
        let paid = 0;
        snapshot.forEach(doc => {
            total++;
            const data = doc.data();
            if (data.paymentStatus === "Paid") paid++;
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${doc.id}</td>
                <td>${data.name || ""}</td>
                <td>${data.email || ""}</td>
                <td>${data.phone || ""}</td>
                <td>
                    <select onchange="updatePaymentStatus('${doc.id}', this.value)">
                        <option value="Unpaid" ${data.paymentStatus === "Unpaid" ? "selected" : ""}>Unpaid</option>
                        <option value="Paid" ${data.paymentStatus === "Paid" ? "selected" : ""}>Paid</option>
                    </select>
                </td>
                <td>${data.dateAdded ? data.dateAdded.toDate().toLocaleString() : ""}</td>
            `;
            table.appendChild(tr);
        });
        document.getElementById("totalUsers").innerText = total;
        document.getElementById("paidUsers").innerText = paid;
    });
}

function updatePaymentStatus(userId, status) {
    db.collection("users").doc(userId).update({
        paymentStatus: status
    });
}

function showAddUserForm() {
    document.getElementById("addUserForm").classList.toggle("hidden");
}

function addUser() {
    const name = document.getElementById("newName").value;
    const email = document.getElementById("newEmail").value;
    const phone = document.getElementById("newPhone").value;
    const status = document.getElementById("newPaymentStatus").value;
    if (!name || !email) {
        alert("Name and Email are required");
        return;
    }
    db.collection("users").add({
        name: name,
        email: email,
        phone: phone,
        paymentStatus: status,
        dateAdded: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
        alert("User added");
        document.getElementById("addUserForm").classList.add("hidden");
        document.getElementById("newName").value = "";
        document.getElementById("newEmail").value = "";
        document.getElementById("newPhone").value = "";
    }).catch(alert);
}
</script>
</body>
</html>
